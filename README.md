# 지불 / 환불 신청서 웹 서비스

대회 운영을 위한 지불/환불 신청, 승인, 정산 웹 서비스입니다. 한국어/영어 전환을 지원합니다.

## 시작하기

### 최초 로그인

1. Google 계정으로 로그인합니다.
2. 최초 로그인 시 기본 정보를 입력하는 화면이 나타납니다.
   - **선호하는 이름** - 통장사본에 기재된 이름과 동일해야 합니다
   - **전화번호** - 연락처 (자동 포맷: 010-0000-0000)
   - **은행 / 계좌번호** - 환불 수령 계좌
   - **소속 위원회** - 운영 위원회 또는 준비 위원회
3. 정보를 입력하고 "시작하기"를 누르면 서비스를 이용할 수 있습니다.

### 통장사본 등록 (필수)

신청서 제출 전에 반드시 통장사본을 등록해야 합니다.

1. 상단 우측의 톱니바퀴 아이콘을 클릭하여 설정으로 이동합니다.
2. **통장사본** 영역에서 파일을 선택하고 **업로드**를 클릭합니다.
3. 업로드 완료 후 미리보기가 표시됩니다.
4. 통장사본은 Google Drive에 안전하게 저장됩니다.

> 통장사본이 등록되지 않으면 신청서를 제출할 수 없습니다.

---

## 일반 사용자 기능

### 신청서 작성

1. 상단 메뉴에서 **새 신청서**를 클릭합니다.
2. 다음 항목을 입력합니다.
   - **신청자, 전화번호, 은행, 계좌번호** - 설정에서 저장한 정보가 자동으로 채워집니다.
   - **날짜** - 지출이 발생한 날짜
   - **위원회** - 소속 위원회가 자동 선택되며, 변경 가능합니다.
   - **항목** - 지출 내역을 입력합니다. (설명, 예산 코드, 금액)
     - "**+ 항목 추가**"로 최대 10개까지 추가할 수 있습니다.
     - 불필요한 항목은 X 버튼으로 삭제합니다.
   - **영수증** - PNG, JPG, PDF 파일만 가능 (파일당 최대 2MB)
   - **비고** - 추가 설명이 필요한 경우 입력합니다.
3. **신청서 제출**을 누르면 확인 모달이 나타납니다.
   - 항목 총액과 영수증 금액이 일치하는지 확인해주세요.
   - "확인 및 제출"을 누르면 신청이 완료됩니다.

#### 필수 항목

신청자, 전화번호, 은행, 계좌번호, 날짜, 항목(1개 이상), 예산 코드, 영수증, 통장사본이 모두 입력/등록되어야 제출할 수 있습니다.

#### 작성 중 임시저장 (Draft)

- 신청서 작성 중 내용이 **자동으로 임시저장**됩니다.
- 설정 페이지에 갔다 와도 작성 내용이 유지됩니다.
- 다른 페이지로 이동하려 하면 알림이 표시됩니다.
- 영수증 파일은 임시저장에 포함되지 않습니다.
- 신청서 제출 완료 시 임시저장 내용은 자동 삭제됩니다.

### 예산 코드 안내

| 코드 | 한국어 | English |
|------|--------|---------|
| 5862 | 숙박/시설 | Lodging/Facilities |
| 5110 | 교통비 | Transportation |
| 5400 | 식비/보험/행정 | Food/Insurance/Admin |
| 5200 | 물품/용품 | Materials/Supplies |
| 4500 | 참가비 | Participation Fee |

### 내 신청 내역 확인

1. 상단 메뉴에서 **내 신청 내역**을 클릭합니다.
2. 제출한 신청서 목록이 표시됩니다.
   - **대기중** - 승인 대기 상태
   - **승인** - 승인 완료
   - **반려** - 반려됨 (사유 확인 가능, 수정 후 재신청 가능)
   - **정산완료** - 정산 처리 완료
3. 날짜를 클릭하면 신청서 상세 내용을 확인할 수 있습니다.

### 반려된 신청서 재신청

1. 반려된 신청서 상세에서 반려 사유를 확인합니다.
2. **수정 후 재신청** 버튼을 클릭합니다.
3. 원본 데이터가 폼에 자동 채워지며, 최소 1개 이상 변경해야 제출할 수 있습니다.
4. 영수증을 새로 첨부하지 않으면 기존 영수증이 유지됩니다.

### 설정 변경

상단 우측의 톱니바퀴 아이콘을 클릭하면 설정 페이지로 이동합니다.

변경 가능한 항목:
- **언어** - 한국어 / English 전환
- 선호하는 이름
- 전화번호
- 은행 / 계좌번호
- 통장사본 (Google Drive 업로드)
- 소속 위원회
- 서명 (승인자인 경우 승인 시 사용)

---

## 승인자 / 관리자 기능

### 권한 종류

| 권한 | 코드 | 설명 |
|------|------|------|
| **일반 사용자** | `user` | 신청서 작성 및 조회 |
| **운영위 승인자** | `approver_ops` | + 운영위원회 신청 승인/반려, 정산 |
| **준비위 승인자** | `approver_prep` | + 준비위원회 신청 승인/반려, 정산 |
| **재정담당** | `finance` | + 전체 신청 승인/반려, 정산, 대시보드, 예산 설정 |
| **관리자** | `admin` | + 전체 권한, 사용자 관리 |

### 신청 관리 (승인자, 재정담당, 관리자)

1. 상단 메뉴에서 **신청 관리**를 클릭합니다.
2. 전체 신청 목록이 표시됩니다.
   - 상단 필터 버튼(전체/대기/승인/정산/반려)으로 필터링할 수 있습니다.
3. 대기중인 신청서에 **승인** 또는 **반려** 버튼이 표시됩니다.
   - **승인** - 서명 모달이 나타납니다. 설정에서 저장한 서명을 사용하거나 새로 그릴 수 있습니다.
   - **반려** - 반려 사유를 반드시 입력해야 합니다.
   - 본인이 신청한 건은 승인/반려할 수 없습니다.
4. 신청서 상세에서 영수증 이미지와 통장사본을 바로 확인할 수 있습니다.

### 정산 (승인자, 재정담당, 관리자)

승인된 신청서들을 신청자별로 정산 처리하고 통합 리포트를 생성합니다.

#### 정산 처리

1. 상단 메뉴에서 **정산**을 클릭합니다.
2. **새 정산 처리** 버튼을 클릭합니다.
3. 승인 완료된 신청서 목록에서 체크박스로 선택합니다.
4. **선택 항목 정산** 버튼을 클릭합니다.
5. 신청자별로 자동 그룹핑되어 **개별 리포트**가 생성됩니다.
6. 승인 서명이 없는 건은 정산할 수 없습니다.

#### 정산 리포트

리포트 내용:
- 신청자 정보 (이름, 전화번호, 은행/계좌)
- 정산일 (리포트 생성일)
- 통합된 항목 목록 및 합계
- 영수증 목록 (Google Drive 링크)
- **Requested by** - 신청자 이름
- **Approved by** - 승인자 서명 + 이름
- **Area Office Finance Verification** - 문서번호, 서명란, 승인일, 비고란

#### PDF 내보내기

1. 정산 리포트에서 **PDF 내보내기** 버튼을 클릭합니다.
2. 리포트 + 영수증 이미지 + 서명 + 재정부 확인란이 포함된 PDF가 생성됩니다.
3. 브라우저 인쇄 대화상자에서 "PDF로 저장"을 선택합니다.

### 대시보드 (재정담당, 관리자)

1. 상단 메뉴에서 **대시보드**를 클릭합니다.
2. 확인할 수 있는 정보:
   - **요약 카드** - 전체/대기/승인/반려 건수 및 금액
   - **예산 현황** - 총 예산 대비 사용률 프로그레스 바
   - **위원회별 현황** - 운영/준비 위원회별 건수, 총액, 승인액
   - **예산 코드별 현황** - 코드별 건수, 승인액, 배정 예산 (초과 시 빨간색)
3. **예산 설정** - 총 예산과 코드별 예산을 설정/수정할 수 있습니다.

### 사용자 관리 (관리자)

1. 상단 메뉴에서 **사용자 관리**를 클릭합니다.
2. 전체 사용자 목록이 표시됩니다.
3. 드롭다운으로 권한을 변경할 수 있습니다 (일반/운영위 승인자/준비위 승인자/재정담당/관리자).
4. 본인의 권한은 변경할 수 없습니다.

---

## 전체 워크플로우

```
[신청자]  신청서 작성 → 제출
              ↓
[승인자]  신청 관리에서 조회 → 영수증/통장사본 확인 → 서명 후 승인 (또는 반려)
              ↓
[승인자]  정산 → 승인된 건 선택 → 신청자별 개별 리포트 생성 → PDF 내보내기
              ↓
[신청자]  내 신청 내역에서 "정산완료" 상태 확인
```

---

## 다국어 지원

설정 페이지에서 한국어/English를 전환할 수 있습니다. 브라우저 언어를 자동 감지하며, 선택한 언어는 저장됩니다.

위원회 영어 명칭:
- 운영 위원회 → Session Committee
- 준비 위원회 → Logistical Committee

---

## 기술 지원

서비스 설정, 배포 및 Mock 데이터에 대한 자세한 내용은 [SETUP.md](./SETUP.md)를 참고하세요.
