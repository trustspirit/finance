# 지불 / 환불 신청서 웹 서비스

FSY 운영을 위한 지불/환불 신청 및 승인 웹 서비스입니다.

## 시작하기

### 최초 로그인

1. Google 계정으로 로그인합니다.
2. 최초 로그인 시 기본 정보를 입력하는 화면이 나타납니다.
   - **선호하는 이름** - 화면 및 신청서에 표시될 이름
   - **전화번호** - 연락처 (자동 포맷: 010-0000-0000)
   - **은행 / 계좌번호** - 환불 수령 계좌
   - **소속 위원회** - 운영 위원회 또는 준비 위원회
3. 정보를 입력하고 "시작하기"를 누르면 서비스를 이용할 수 있습니다.

### 통장사본 등록 (필수)

신청서 제출 전에 반드시 통장사본을 등록해야 합니다.

1. 상단 우측의 **톱니바퀴 아이콘**을 클릭하여 설정으로 이동합니다.
2. **통장사본** 영역에서 파일을 선택하고 **업로드**를 클릭합니다.
3. 업로드 완료 후 미리보기가 표시됩니다.
4. 통장사본은 Google Drive에 안전하게 저장됩니다.

> 통장사본이 등록되지 않으면 신청서를 제출할 수 없습니다.

---

## 일반 사용자 기능

### 신청서 작성

1. 상단 메뉴에서 **새 신청서**를 클릭합니다.
2. 다음 항목을 입력합니다.
   - **신청자, 전화번호, 은행, 계좌번호** - 설정에서 저장한 정보가 자동으로 채워집니다.
   - **날짜** - 지출이 발생한 날짜
   - **위원회** - 기본 위원회가 자동 선택되며, 변경 가능합니다.
   - **항목** - 지출 내역을 입력합니다. (설명, 예산 코드, 금액)
     - "**+ 항목 추가**"로 최대 10개까지 추가할 수 있습니다.
     - 불필요한 항목은 **X** 버튼으로 삭제합니다.
   - **영수증** - 영수증 이미지 또는 PDF 파일을 첨부합니다. (필수)
   - **비고** - 추가 설명이 필요한 경우 입력합니다.
3. **신청서 제출**을 누르면 확인 모달이 나타납니다.
   - 항목 총액과 영수증 금액이 일치하는지 확인해주세요.
   - "확인 및 제출"을 누르면 신청이 완료됩니다.

#### 필수 항목

신청자, 전화번호, 은행, 계좌번호, 날짜, 항목(1개 이상), 예산 코드, 영수증, 통장사본이 모두 입력/등록되어야 제출할 수 있습니다. 누락된 항목이 있으면 상단에 빨간색 안내가 표시됩니다.

#### 작성 중 임시저장 (Draft)

- 신청서 작성 중 내용이 **자동으로 임시저장**됩니다.
- 설정 페이지에 갔다 와도 작성 내용이 유지됩니다.
- 다른 페이지로 이동하려 하면 "작성 중인 신청서가 있습니다" 알림이 표시됩니다.
  - **계속 작성** - 현재 페이지에 머무릅니다.
  - **페이지 이동** - 내용이 자동 저장되어 다시 돌아오면 이어서 작성할 수 있습니다.
- 복원된 신청서가 있으면 상단에 파란색 배너로 안내됩니다. "초기화" 버튼으로 삭제할 수 있습니다.
- 영수증 파일은 임시저장에 포함되지 않으므로, 복원 시 다시 첨부해야 합니다.
- 신청서 제출 완료 시 임시저장 내용은 자동 삭제됩니다.

### 예산 코드 안내

| 코드 | 용도 |
|------|------|
| 5862 | 숙소, 시설 대여 |
| 5110 | 교통비 |
| 5400 | 식비, 보험, 행정 비용 |
| 5200 | 활동 물품, 인쇄물 |
| 4500 | 참가비 |

### 내 신청 내역 확인

1. 상단 메뉴에서 **내 신청 내역**을 클릭합니다.
2. 제출한 신청서 목록이 표시됩니다.
   - **대기중** (노란색) - 승인 대기 상태
   - **승인** (초록색) - 승인 완료
   - **반려** (빨간색) - 반려됨
   - **정산완료** (보라색) - 정산 처리 완료
3. 날짜를 클릭하면 신청서 상세 내용을 확인할 수 있습니다.
   - 영수증 이미지 미리보기 (클릭하면 Google Drive 원본)
   - 통장사본 미리보기
   - 승인자 정보 및 승인 서명
   - 정산완료 건은 정산 리포트 링크 표시

### 설정 변경

상단 우측의 **톱니바퀴 아이콘**을 클릭하면 설정 페이지로 이동합니다.

변경 가능한 항목:
- 선호하는 이름
- 전화번호
- 은행 / 계좌번호
- 통장사본 (Google Drive 업로드)
- 기본 위원회
- 서명 (승인자인 경우 승인 시 사용)

변경 후 **저장**을 눌러야 반영됩니다. 저장된 정보는 다음 신청서 작성 시 자동으로 채워집니다. 통장사본은 별도 **업로드** 버튼을 눌러야 저장됩니다.

---

## 승인자 / 관리자 기능

### 권한 종류

| 권한 | 설명 |
|------|------|
| **일반 사용자** | 신청서 작성 및 조회 |
| **승인자** (approver) | + 신청 관리 (승인/반려), 정산, 예산 설정 |
| **관리자** (admin) | + 대시보드, 사용자 관리 |

### 신청 관리 (승인자, 관리자)

1. 상단 메뉴에서 **신청 관리**를 클릭합니다.
2. 전체 신청 목록이 표시됩니다.
   - 상단 필터 버튼(전체/대기/승인/정산/반려)으로 필터링할 수 있습니다.
3. 대기중인 신청서에 **승인** 또는 **반려** 버튼이 표시됩니다.
   - **승인** 클릭 시 서명 모달이 나타납니다.
     - 설정에서 저장한 서명이 있으면 "저장된 서명 사용"을 체크할 수 있습니다.
     - 새로 서명을 그릴 수도 있습니다.
     - "서명하고 승인"을 누르면 승인이 완료됩니다.
   - **반려** 클릭 시 확인 후 반려됩니다.
4. 신청서 상세에서 영수증 이미지와 통장사본을 바로 확인할 수 있습니다.

### 정산 (승인자, 관리자)

승인된 신청서들을 선택하여 정산 처리하고, 신청자별 통합 리포트를 생성합니다.

#### 정산 처리

1. 상단 메뉴에서 **정산**을 클릭합니다.
2. 정산 내역 목록 페이지에서 **새 정산 처리** 버튼을 클릭합니다.
3. 승인 완료된 신청서 목록이 표시됩니다.
4. 체크박스로 정산할 신청서를 선택합니다.
   - 전체 선택/해제 가능
   - 상단에 선택 건수, 신청자 수, 총액이 요약 표시됩니다.
5. **선택 항목 정산** 버튼을 클릭합니다.
6. 신청자별로 자동 그룹핑되어 통합 리포트가 생성됩니다.
7. 정산 처리된 신청서의 상태가 **정산완료**(보라색)로 변경됩니다.

#### 정산 리포트

- 정산 내역 목록에서 **보기** 링크를 클릭하면 통합 리포트를 확인할 수 있습니다.
- 리포트 내용:
  - 신청자 정보 (이름, 전화번호, 은행/계좌)
  - 정산일 (리포트 생성일 기준)
  - 통합된 항목 목록 및 합계
  - 통합된 영수증 목록 (Google Drive 링크)
  - 승인 서명

#### PDF 내보내기

1. 정산 리포트 상세 페이지에서 **PDF 내보내기** 버튼을 클릭합니다.
2. 리포트와 영수증 이미지가 포함된 PDF가 생성됩니다.
   - 첫 페이지: 신청자 정보, 항목 목록, 합계, 승인 서명
   - 이후 페이지: 첨부 영수증 이미지
3. 브라우저 인쇄 대화상자에서 "PDF로 저장"을 선택합니다.

### 대시보드 (관리자)

1. 상단 메뉴에서 **대시보드**를 클릭합니다.
2. 다음 정보를 확인할 수 있습니다.
   - **요약 카드** - 전체/대기(금액)/승인(금액)/반려 건수
   - **예산 현황** - 총 예산 대비 사용률 프로그레스 바 (70% 노란색, 90% 빨간색 경고)
     - 총 예산, 사용액(승인), 대기중, 잔여 금액 표시
   - **위원회별 현황** - 운영/준비 위원회별 건수, 총액, 승인액
   - **예산 코드별 현황** - 코드별 건수, 승인액, 배정 예산 (초과 시 빨간색)
3. **예산 설정** (하단)
   - "수정" 버튼을 클릭하여 총 예산과 코드별 예산을 설정합니다.
   - 코드별 합계가 실시간으로 표시됩니다.
   - 예산을 설정하면 대시보드 상단에 예산 현황 바가 표시됩니다.

### 사용자 관리 (관리자)

1. 상단 메뉴에서 **사용자 관리**를 클릭합니다.
2. 전체 사용자 목록이 표시됩니다 (선호 이름, Google 이름, 이메일, 전화번호, 권한).
3. 드롭다운으로 권한을 변경할 수 있습니다.
   - 일반 사용자 / 승인자 / 관리자
   - 본인의 권한은 변경할 수 없습니다.

---

## 전체 워크플로우

```
[신청자]  신청서 작성 → 제출
              ↓
[승인자]  신청 관리에서 조회 → 영수증/통장사본 확인 → 서명 후 승인 (또는 반려)
              ↓
[승인자]  정산 → 승인된 건 선택 → 신청자별 통합 리포트 생성 → PDF 내보내기
              ↓
[신청자]  내 신청 내역에서 "정산완료" 상태 확인
```

---

## 기술 지원

서비스 설정 및 배포에 대한 자세한 내용은 [SETUP.md](./SETUP.md)를 참고하세요.
